// room script file

World world;
float step;
Body* b1;
Body* b2;
Overlay* ovr1;
Overlay* ovr2;
DynamicSprite* dnspr1;
DynamicSprite* dnspr2;

Overlay* DrawBody(Body* b, Overlay* ovr, DynamicSprite* dnspr)
{
  if(ovr == null) {
    ovr = Overlay.CreateGraphical(FloatToInt(b.position_x+64.0), FloatToInt(b.position_y+64.0), dnspr.Graphic);
  }
    
  ovr.Graphic = dnspr.Graphic;
  ovr.X = FloatToInt(b.position_x + 64.0);
  ovr.Y = FloatToInt(b.position_y + 64.0);
  ovr.Width = FloatToInt(b.width_x);
  ovr.Height = FloatToInt(b.width_y);
  ovr.Rotation = Maths.RadiansToDegrees(b.rotation);
  
  return ovr;
}

function room_Load()
{
  world.Init(0.0, -9.8);
  step = 1.0/IntToFloat(GetGameSpeed());
  
  b1 = Body.Create();
  b1.Set(Vec2.New(100.0, 20.0), FLT_MAX);
  b1.position_x = 0.0;
  b1.position_y = -0.5* b1.width_y;
  
  world.AddBody(b1);
  
  b2 = Body.Create();
  b2.Set(Vec2.New(1.0, 1.0), 200.0);
  b2.position_x = 0.0;
  b2.position_y = 4.0;
	world.AddBody(b2);

  DrawingSurface* surf;
  dnspr1 = DynamicSprite.Create(FloatToInt(b1.width_x), FloatToInt(b1.width_y));
  surf = dnspr1.GetDrawingSurface();
  surf.Clear(22420);
  surf.Release();
  dnspr2 = DynamicSprite.Create(FloatToInt(b1.width_x), FloatToInt(b1.width_y));
  surf = dnspr2.GetDrawingSurface();
  surf.Clear(56436);
  surf.Release();
  
}

function room_RepExec()
{
  world.Step(step);
  ovr1 = DrawBody(b1, ovr1, dnspr1);
  ovr2 = DrawBody(b2, ovr2, dnspr2);
  
}
